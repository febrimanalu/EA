DECLARE @Temps TABLE (Condition varchar(50), DateInspection datetime, NextPM datetime, Status varchar(50),Period int)
DECLARE @Summary TABLE (Cond varchar(50),Total int,RowCategory varchar(50),RowType varchar(75),RowIcon varchar(75))

SELECT A.Condition, A.DateInspection, A.NextPM, A.Status, 28 as Period FROM (
    SELECT c.Status AS 'Condition', 
    isnull(c.LastPM_date, '2018-01-01') AS 'DateInspection',
    DATEADD(day,28,isnull(c.LastPM_date,'2018-01-01')) as NextPM,
    CASE WHEN DATEADD(DAY, 29, isnull(c.LastPM_date,'2018-01-01')) < GETDATE() THEN 'Past Due'
    WHEN GETDATE() BETWEEN c.LastPM_date AND DATEADD(DAY, 26, c.LastPM_date) THEN 'GOOD' 
    WHEN GETDATE() BETWEEN DATEADD(DAY, 26,c.LastPM_date) AND DATEADD(DAY, 29, c.LastPM_date) THEN 'ALERT'  ELSE c.Status END AS 'Status'
    FROM udt_Fixture c
	WHERE c.ItemID = 10 and c.Status IN ('GOOD', 'SCRAP', 'REPAIR','AVAIABLE','CLEANED','Past Due')
	) A;
  
INSERT INTO @Summary(Cond, Total, RowCategory, RowType, RowIcon)
SELECT 'GOOD' AS 'Cond', COUNT(*) AS Total, 'col-lg-3 col-md-6' AS RowCategory, 'widget-two-teal' AS RowType, 'mdi mdi-check' AS RowIcon FROM @Temps A
WHERE (A.Condition = 'AVAIABLE' OR A.Condition = 'GOOD' OR A.Condition = 'CLEANDED') AND A.Status = 'GOOD' ;

INSERT INTO @Summary(Cond, Total, RowCategory, RowType, RowIcon)
SELECT 'ALERT' AS 'Cond', COUNT(*) AS Total, 'col-lg-2 col-md-6' AS RowCategory, 'widget-two-warning' AS RowType, 'mdi mdi-alert' AS RowIcon FROM @Temps B
WHERE (B.Condition = 'AVAIABLE' OR B.Condition = 'GOOD' OR B.Condition = 'CLEANDED') AND B.Status = 'ALERT' ;

INSERT INTO @Summary(Cond, Total, RowCategory, RowType, RowIcon)
SELECT 'INSERVICE' AS 'Cond', COUNT(*) AS Total, 'col-lg-2 col-md-6' AS RowCategory, 'widget-two-primary' AS RowType, 'mdi mdi-wrench' AS RowIcon FROM @Temps C
WHERE (C.Condition = 'REPAIR' OR C.Condition = 'SCRAP') ;

INSERT INTO @Summary(Cond, Total, RowCategory, RowType, RowIcon)
SELECT 'Past Due' AS 'Cond', COUNT(*) AS Total, 'col-lg-2 col-md-6' AS RowCategory, 'widget-two-danger' AS RowType, 'mdi mdi-close-octagon' AS RowIcon FROM @Temps D
WHERE D.Condition IN ('GOOD','AVAIABLE','CLEANED','Past Due') AND D.Status = 'Past Due' ;

INSERT INTO @Summary(Cond, Total, RowCategory, RowType, RowIcon)
SELECT 'TOTAL' AS 'Cond', COUNT(*) AS Total, 'col-lg-3 col-md-6' AS RowCategory, 'widget-two-success' AS RowType, 'mdi mdi-clipboard-check' AS RowIcon FROM @Temps E;

SELECT Cond, convert(varchar,Total,100) as Total, RowCategory, RowType, RowIcon FROM @Summary;